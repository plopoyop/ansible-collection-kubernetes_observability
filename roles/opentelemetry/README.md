# opentelemetry

Install and configure Opentelemetry Stack on kubernetes

## Table of content

- [Requirements](#requirements)
- [Default Variables](#default-variables)
  - [opentelemetry_additional_config](#opentelemetry_additional_config)
  - [opentelemetry_chart_version](#opentelemetry_chart_version)
  - [opentelemetry_cleanup_job_image_repository](#opentelemetry_cleanup_job_image_repository)
  - [opentelemetry_cluster_name](#opentelemetry_cluster_name)
  - [opentelemetry_collectors](#opentelemetry_collectors)
  - [opentelemetry_collectors_daemon_config](#opentelemetry_collectors_daemon_config)
  - [opentelemetry_crd_force_upgrade](#opentelemetry_crd_force_upgrade)
  - [opentelemetry_default_collector_additional_config](#opentelemetry_default_collector_additional_config)
  - [opentelemetry_default_collector_config_enabled](#opentelemetry_default_collector_config_enabled)
  - [opentelemetry_default_collector_config_exporters](#opentelemetry_default_collector_config_exporters)
  - [opentelemetry_default_collector_config_extensions](#opentelemetry_default_collector_config_extensions)
  - [opentelemetry_default_collector_config_processors](#opentelemetry_default_collector_config_processors)
  - [opentelemetry_default_collector_config_receivers](#opentelemetry_default_collector_config_receivers)
  - [opentelemetry_default_collector_config_services](#opentelemetry_default_collector_config_services)
  - [opentelemetry_enabled](#opentelemetry_enabled)
  - [opentelemetry_instrumentations](#opentelemetry_instrumentations)
  - [opentelemetry_kube_api_enabled](#opentelemetry_kube_api_enabled)
  - [opentelemetry_kube_controller_manager_enabled](#opentelemetry_kube_controller_manager_enabled)
  - [opentelemetry_kube_dns_enabled](#opentelemetry_kube_dns_enabled)
  - [opentelemetry_kube_etcd_enabled](#opentelemetry_kube_etcd_enabled)
  - [opentelemetry_kube_proxy_enabled](#opentelemetry_kube_proxy_enabled)
  - [opentelemetry_kube_scheduler_enabled](#opentelemetry_kube_scheduler_enabled)
  - [opentelemetry_kube_state_metrics_enabled](#opentelemetry_kube_state_metrics_enabled)
  - [opentelemetry_kubelet_enabled](#opentelemetry_kubelet_enabled)
  - [opentelemetry_kubernetes_service_monitors_enabled](#opentelemetry_kubernetes_service_monitors_enabled)
  - [opentelemetry_namespace](#opentelemetry_namespace)
  - [opentelemetry_node_exporter_enabled](#opentelemetry_node_exporter_enabled)
  - [opentelemetry_operator_config](#opentelemetry_operator_config)
  - [opentelemetry_operator_crd_version](#opentelemetry_operator_crd_version)
  - [opentelemetry_release_name](#opentelemetry_release_name)
  - [opentelemetry_upgrade_crd](#opentelemetry_upgrade_crd)
- [Dependencies](#dependencies)
- [License](#license)
- [Author](#author)

---

## Requirements

- Minimum Ansible version: `2.1`


## Default Variables

### opentelemetry_additional_config

additional values for opentelemetry helm chart
opentelemetry_additional_config:example: >
opentelemetry_additional_config:
manager:
collectorImage:
repository: otel/opentelemetry-collector-contrib

### opentelemetry_chart_version

Opentelemetry chart version

#### Default value

```YAML
opentelemetry_chart_version: 0.12.5
```

### opentelemetry_cleanup_job_image_repository

Cleanup job delete hook image name

#### Default value

```YAML
opentelemetry_cleanup_job_image_repository: rancher/kubectl
```

### opentelemetry_cluster_name

Cluster name for Opentelemetry

#### Default value

```YAML
opentelemetry_cluster_name: '{{ ansible_host }}'
```

### opentelemetry_collectors

additional collectors to create
opentelemetry_collectors:example: >
opentelemetry_collectors:
collectorName:
enabled: true
name: "example"

### opentelemetry_collectors_daemon_config

Configmap for default daemon collector
opentelemetry_collectors_daemon_config:example: >
opentelemetry_collectors_daemon_config:
resources:
limits:
cpu: 400m
memory: 7500Mi
requests:
cpu: 200m
memory: 250Mi

### opentelemetry_crd_force_upgrade

Force CRDs upgrade, even if helm package is not in "deployed" state

#### Default value

```YAML
opentelemetry_crd_force_upgrade: false
```

### opentelemetry_default_collector_additional_config

additional configuration to apply for all collectors

#### Example usage

```YAML
opentelemetry_default_collector_additional_config:
  targetAllocator:
    enabled: false
```

### opentelemetry_default_collector_config_enabled

Enable default configuration for all collectors generated by the chart

### opentelemetry_default_collector_config_exporters

Opentelemetry exporters to apply to all collectors

#### Default value

```YAML
opentelemetry_default_collector_config_exporters:
  debug: {}
```

### opentelemetry_default_collector_config_extensions

Opentelemetry extensions to apply to all collectors
opentelemetry_default_collector_config_extensions:example: >
opentelemetry_default_collector_config_extensions:
zpages: {}

### opentelemetry_default_collector_config_processors

Opentelemetry processors to apply to all collectors
opentelemetry_default_collector_config_processors:example: >
opentelemetry_default_collector_config_processors:
batch:
send_batch_size: 1000
timeout: 1s
send_batch_max_size: 1500

### opentelemetry_default_collector_config_receivers

Opentelemetry receivers to apply to all collectors

#### Default value

```YAML
opentelemetry_default_collector_config_receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318
```

### opentelemetry_default_collector_config_services

Opentelemetry services to apply to all collectors
opentelemetry_default_collector_config_services:example: >
opentelemetry_default_collector_config_services:
extensions: [zpages]
pipelines:
traces:
receivers: [otlp]
processors: [memory_limiter, batch]
exporters: [otlp]#

### opentelemetry_enabled

Install Grafana chart

#### Default value

```YAML
opentelemetry_enabled: true
```

### opentelemetry_instrumentations

Opentelemetry instrumentation custom resources

#### Default value

```YAML
opentelemetry_instrumentations: []
```

#### Example usage

```YAML
opentelemetry_instrumentations:
  - name: "java-auto-instrumentation"
    endpoint: "http://otel-collector-daemon-collector.otel.svc.cluster.local:4318"
    propagators:
      - tracecontext
      - baggage
    sampler:
      type: parentbased_traceidratio
      argument: "1"
    state: "present"
    instrumentations:
      java:
        image: ghcr.io/open-telemetry/opentelemetry-operator/autoinstrumentation-java:2.15.0
        env:
          - name: OTEL_TRACES_EXPORTER
            value: "otlp"
          - name: OTEL_LOGS_EXPORTER
            value: "otlp"
          - name: OTEL_METRICS_EXPORTER
            value: "none"
```

### opentelemetry_kube_api_enabled

Component scraping the kube api server

#### Default value

```YAML
opentelemetry_kube_api_enabled: true
```

### opentelemetry_kube_controller_manager_enabled

Enable component scraping the kube controller manager

#### Default value

```YAML
opentelemetry_kube_controller_manager_enabled: true
```

### opentelemetry_kube_dns_enabled

Enable component scraping kubeDns. Use either this or coreDns

#### Default value

```YAML
opentelemetry_kube_dns_enabled: true
```

### opentelemetry_kube_etcd_enabled

Enable component scraping etcd

#### Default value

```YAML
opentelemetry_kube_etcd_enabled: true
```

### opentelemetry_kube_proxy_enabled

Enable component scraping kube proxy

#### Default value

```YAML
opentelemetry_kube_proxy_enabled: true
```

### opentelemetry_kube_scheduler_enabled

Enable component scraping kube scheduler

#### Default value

```YAML
opentelemetry_kube_scheduler_enabled: true
```

### opentelemetry_kube_state_metrics_enabled

Controls whether the kube-state-metrics chart should be created

#### Default value

```YAML
opentelemetry_kube_state_metrics_enabled: true
```

### opentelemetry_kubelet_enabled

Enable component scraping the kubelet and kubelet-hosted cAdvisor

#### Default value

```YAML
opentelemetry_kubelet_enabled: true
```

### opentelemetry_kubernetes_service_monitors_enabled

Enable presets for kubernetes service monitoring

#### Default value

```YAML
opentelemetry_kubernetes_service_monitors_enabled: true
```

### opentelemetry_namespace

K8s namespace to install Opentelemetry chart

#### Default value

```YAML
opentelemetry_namespace: opentelemetry
```

### opentelemetry_node_exporter_enabled

Controls whether the prometheus-node-exporter chart should be created

#### Default value

```YAML
opentelemetry_node_exporter_enabled: true
```

### opentelemetry_operator_config

Opentelemetry Operator configuration
opentelemetry_operator_config:example: >
opentelemetry_operator_config:
manager:
collectorImage:
repository: otel/opentelemetry-collector-contrib

### opentelemetry_operator_crd_version

Git ref for CRDs manifest

#### Default value

```YAML
opentelemetry_operator_crd_version: tags/v0.136.0
```

### opentelemetry_release_name

Release name for Opentelemetry

#### Default value

```YAML
opentelemetry_release_name: otel-collector
```

### opentelemetry_upgrade_crd

Upgrade CRDs with github manifest

#### Default value

```YAML
opentelemetry_upgrade_crd: false
```



## Dependencies

None.

## License

MLP2

## Author

Cl√©ment Hubert
